# Introduction
The idea behind this app is to create a Java version of the Linux `grep` command, which allows users to search for matching strings from files. Like the `grep` command, this app recursively traverses a given file path and will output all matching strings into a given output file. It was written using core Java features and libraries (like regex, lambda, Stream API, JUnit, etc.) in the IntelliJ IDE, compiled using Maven, and persisted using Docker.

# Quick Start
```bash
cd core_java/grep

#compile and package the Java code
mvn clean compile package 

#In order to run the base version:
java -cp target/grep-1.0-SNAPSHOT.jar ca.jrvs.apps.grep.JavaGrepImp [REGEX] [ROOT_PATH] [OUTPUT_FILE]

#In order to run the lambda implementation:
java -cp target/grep-1.0-SNAPSHOT.jar ca.jrvs.apps.grep.JavaGrepLambdaImp [REGEX] [ROOT_PATH] [OUTPUT_FILE]

#If file size is significantly large:
java -Xms[MIN_HEAP_SIZE] -Xmx[MAX_HEAP_SIZE] -cp target/grep-1.0-SNAPSHOT.jar ca.jrvs.apps.grep.JavaGrepLambdaImp [REGEX] [ROOT_PATH] [OUTPUT_FILE]
```

| Argument          | Description                              |
|-------------------|------------------------------------------|
| `[REGEX]`         | A Java Regex to match with.              |
| `[ROOT_PATH]`     | The root file path to search.            |
| `[OUTPUT_FILE]`   | The file to write the search results to. |
| `[MIN_HEAP_SIZE]` | The minimum heap size to use.            |
| `[MAX_HEAP_SIZE]` | The maximum heap size to use.            |

# Implementation
## Pseudocode
Here is the pseudocode for process:
```python
matchedLines = []
for file in listFilesRecursively(rootDir)
  for line in readLines(file)
      if containsPattern(line)
        matchedLines.add(line)
writeToFile(matchedLines)
```

## Performance Issue
There is a notable issue when the data to be read is significantly large (larger than the physical memory size). When this occurs, the app can crash with an `OutOfMemoryError`. To fix this issue, we use the lambda implementation, which takes advantage of Stream APIs, and we can change the grep interface to return streams instead of lists. With this change, we can support larger file sizes without the threat of memory errors.

# Testing
How did you test your application manually? (e.g. prepare sample data, run some test cases manually, compare result)
There was no CI/CD setup for this project, so testing was done using JUnit4, and manual testing where appropriate. JUnit was used to test the classes in the `/practice` directory, and manual testing was used on the `/grep` directory. This was done simply due to the fact that we can check the output produced by `/grep` classes by looking at the output file. 

Here is an example of JUnit testing, which tests a method for the `RegExcImp` class:
```java
@Test
public void testMatchCsv() {
  assertTrue(tester.matchCsv("myfile.csv"));
  assertTrue(tester.matchCsv("my-file.csv"));
  assertFalse(tester.matchCsv("myfile.csvx"));
  assertFalse(tester.matchCsv("myfile_csv"));
  assertFalse(tester.matchCsv(".csv"));
  assertFalse(tester.matchCsv("csv"));
}
```

Here is an example of manual testing, which tests the output of this app against the output generated by the Linux `grep` command.

Expected:
```bash
$ grep .*Romeo.*Juliet.* ./data/txt/shakespeare.txt 
    Is father, mother, Tybalt, Romeo, Juliet,
Enter Romeo and Juliet aloft, at the Window.
    And Romeo dead; and Juliet, dead before,
    Romeo, there dead, was husband to that Juliet;
```

Result:
```bash
$ java -cp target/grep-1.0-SNAPSHOT.jar ca.jrvs.apps.grep.JavaGrepImp .*Romeo.*Juliet.* ./data ./out/grep.out
```
![image](https://user-images.githubusercontent.com/56552567/170576775-8ab85e95-a62f-4737-bfcc-b6dad4867b79.png)


# Deployment
This app has been dockerized for easier distribution using the steps below:

```bash
docker_user=your_docker_id
docker login -u ${docker_user} --password-stdin 

#Create the dockerfile 
cat > Dockerfile << EOF
FROM openjdk:8-alpine
COPY target/grep*.jar /usr/local/app/grep/lib/grep.jar
ENTRYPOINT ["java","-jar","/usr/local/app/grep/lib/grep.jar"]
EOF

#Package the java app
mvn clean package

#build the new docker image locally
docker build -t ${docker_user}/grep .

#run the docker container 
docker run --rm \
-v `pwd`/data:/data -v `pwd`/log:/log \
${docker_user}/grep .*Romeo.*Juliet.* /data /log/grep.out

#push the image to Docker Hub
docker push ${docker_user}/grep
```

# Improvements
1. Further memory optimization - there are most likely other ways to optimize memory utilization, so it would be wise to investigate this in the future.
2. Further testing - it's entirely possible that there are unforeseen issues within the code, so more JUnit testing/automated testing would be a good improvement.
3. Expanding functionality - this app is a Java implementation of the `grep` command on Linux, so it would be nice to include more of the common arguments to `grep`, such as `--ignore-case`, especially since it would be relatively simple to implement.




